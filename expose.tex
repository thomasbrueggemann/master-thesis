%
% Expose: Master Thesis
% Thomas Brüggemann
%

% -----------
% 1. Präambel
% -----------

% Allgemeine Einstellungen
% ------------------------
\documentclass[
	a4paper,
	oneside,
	12pt,
	liststotocnumbered
]{article}
\usepackage{times}            % Times New Roman

\usepackage[utf8]{inputenc}   % utf-8
\usepackage[english]{babel}    % english hyphenation
\selectlanguage{english}       % english titles
\usepackage{nicefrac} 
\usepackage{longtable}

% Titel-Font-Größen
\usepackage{titlesec}
\titleformat{\section}{\bfseries}{\thesection.}{12pt}{}
\titleformat{\subsection}{\bfseries}{\thesubsection }{12pt}{}

% Seitenränder
\usepackage[
    top=2.5cm, 
    bottom=2.5cm, 
    left=5cm, 
    right=1cm
]{geometry} 

% Fussnoten
\usepackage[hang,flushmargin]{footmisc}    
\renewcommand*{\footnotelayout}{\footnotesize} % size of text
\renewcommand{\footnotemargin}{2.2em}          % margin between text and number
\setlength{\footnotesep}{1.3em}                % space between footnotes
\setlength{\skip\footins}{2.5em}               % space between text & footnotes
\usepackage{savefnmark}

% Abkürzungen
\usepackage[printonlyused]{acronym}    
\renewcommand{\bflabel}[1]{{#1\hfill}}

% Seitennummerierung oben
\usepackage{scrpage2} 
\usepackage[dvips]{color}
\clearscrheadfoot 
\chead[\pagemark]{\textcolor[gray]{0.5}{\pagemark}} 
\pagestyle{scrheadings}

% TOC, LOF, FIG Styles
\usepackage{tocloft, titletoc}  
\setlength{\cftaftertoctitleskip}{0em}
\renewcommand{\cftloftitlefont}{\bfseries}
%\renewcommand{\cftfigfont}{\bfseries}
\renewcommand{\cfttoctitlefont}{\bfseries}
\renewcommand{\cftlottitlefont}{\bfseries}
\titlecontents{section}     % set formatting for \section 
[2.3em]                     % adjust left margin
{\vspace{0.5em}}            % font formatting
{\hspace{-1.8em}.\contentslabel{0.7em}\hspace{1em}} % section label and offset
{\hspace*{-2.3em}}
{\titlerule*[1mm]{.}\contentspage}

\titlecontents{subsection}  % set formatting for \subsection 
[3em]                       % adjust left margin
{\vspace{0.5em}}            % font formatting
{\contentslabel{2.3em}}     % section label and offset
{\hspace*{-2.3em}}
{\titlerule*[1mm]{.}\contentspage}

\titlecontents{subsubsection}  % set formatting for \subsubsection 
[4.2em]                       % adjust left margin
{\vspace{0.5em}}            % font formatting
{\contentslabel{2.3em}}     % section label and offset
{\hspace*{-2.3em}}
{\titlerule*[1mm]{.}\contentspage}

\titlecontents{figure}      % set formatting for \subsection 
[2.3em]                     % adjust left margin
{\vspace{0.5em}}            % font formatting
{\contentslabel{2.3em}}     % section label and offset
{\hspace*{-2.3em}}
{\titlerule*[1mm]{.}\contentspage}

\titlecontents{table}       % set formatting for \subsection 
[3.4em]                     % adjust left margin
{\vspace{0.5em}}            % font formatting
{:\hspace*{0.9em}\contentslabel{4.5em}}     % section label and offset
{\hspace*{-2.3em}}
{\titlerule*[1mm]{.}\contentspage}


% Literaturverzeichnis
\usepackage[
    bibstyle=authortitle,
    citestyle=authoryear,
    backend=biber,
    isbn=false,
    url=false,
    doi=false,
    maxcitenames=3,
    maxbibnames=30
]{biblatex}
\addbibresource{library.bib}
\let\cite\textcite

\usepackage{caption}
\usepackage{chngcntr}

% Tabellenpackete
\usepackage{array}
\usepackage{xcolor}
\usepackage{longtable}
\usepackage{setspace}
\counterwithin{table}{section}
\usepackage{multirow}

% Grafiken anzeigen
\usepackage[pdftex]{graphicx}
\graphicspath{{figures}}
\counterwithin{figure}{section}
\usepackage[absolute,overlay]{textpos}

\begin{document}

% Renews
\renewcommand{\figurename}{Figure}
\renewcommand{\tablename}{Table}
\renewcommand\thefigure{\arabic{section}-\arabic{figure}}
\renewcommand\thetable{Tab. \arabic{section}-\arabic{table}}
\newcommand{\todo}[1]{\textbf{\textsc{\textcolor{red}{TODO: #1}}}}

% Variables
\newcommand{\mH}{mHealth }
\newcommand{\ap}{app provider}
\newcommand{\pp}{privacy policy}
\newcommand{\pps}{privacy policies}
\newcommand{\sca}{static code analysis}
\newcommand{\Sca}{Static code analysis}

\pagenumbering{Roman}

% Deckblatt
% ---------
\include{titlepages/cover}

% Inhaltsverzeichnis anzeigen
% ---------------------------
\tocloftpagestyle{scrheadings}
\tableofcontents
\newpage

% Abkürzungsverzeichnis
\section*{Index of Abbreviations}
\addcontentsline{toc}{section}{Index of Abbreviations}
\begin{acronym}[TTTTTTTTTTTTTTTTTTTT]
	\acro{API}{Application programming interface}
	\acro{APK}{Android application package}
	\acro{DEX}{Dalvik executable}
	\acro{DRM}{Digital rights management}
	\acro{HTTP}{Hypertext Transfer Protocol}
	\acro{JAR}{Java archive}
	\acro{JVM}{Java virtual machine}
    \acro{mHealth}{Mobile health}
\end{acronym}
\newpage

\normalsize
\setstretch{1,5}
\pagenumbering{arabic}

% PROBLEM STATEMENT %
\section{Problem Statement}
The market for mobile smart device applications (apps) is growing extensively in recent years. 
It is increasingly easier for small companies or even single developers to create unique apps that reach millions of users via app stores.
This market growth also effected mobile health (\acs{mHealth}) apps. 
More and more apps are available that support the users in solving their health related issues and information deficiencies. 
Users are asked to input their personal information in order to tailor the app to their custom needs. 
The users are asked to expose vulnerable information about their health status while it remains mostly unclear how and where the data is processed, stores or tossed along.

The information about privacy practices of the \ap s should be found in the privacy policy document provided by the \ap.
Processing these \pps requires a higher level of education and time to read through large documents of text to find the relevant information. 
Additionally, the important information is hidden in legal language or insufficiently addressed, if at all.\footnote{\cite{Dehling2014}, p. 11}

Aside from the data usage beyond users control, it is also challenging for users to assess what kind of privat information an app asks for, in order to tailor the app experience. 
Users have to download the apps of interest and try them out, before it becomes clear what information is used. 
This leads to low inter comparability between apps. If users are looking for specific functionality in a \mH app, it is challenging to find the app that offers the desired functionality at an acceptable privacy risk. 
Even if users would persue the goal to find and compare \mH apps of similar functionality, the high volume of apps available on the app stores\footnote{\cite{Enck2011}, p. 1} makes it not feasable to review all of them by hand.

Resolving the challenges in evaluating the privacy risk of \mH apps, before usage and of large volumes, will result in an improved decision making process for users. 
It also reduces the danger of exposing vulnerable information. 
A way to assess privacy risks of \mH apps would be to automate the review of each individual app. 
Automating the review process for large scale app assessments has the potential to grow new privacy evaluation service markets.\footnote{\cite{Enck2011}, p. 14}
Automating the app assessment for potential privacy risk factors  can be done by downloading and analyzing the source of each app to trace data leaks. 
\Sca is used in the field of informatics to analyse application source code to detect faults or vulnerabilities.\footnote{\cite{Baca2008}, p. 79} 
A \sca could potentially be used to assess the privacy risks that mHealth apps pose.

The automated process of assessing the privacy risk helps to reduce the costs of reviewing each individual app and enhances the information experience users get while researching mHealth apps.Additionally, it exposes new possibilities for research in the privacy risk area. The research could be conducted on providing solutions and best practices for minimizing the privacy risk of apps.
It is unclear if, and to what degree, the concepts of static code analysis and privacy risk assessment can be combined in order to automate the app assessment.
This leads to the research question of this master thesis. How and to what degree can the privacy risk assessment of mHealth apps be automated?

\todo{Related Work bei \cite{xu2013techniques} abschauen}
Previous research in this field revealed...

% OBJECTIVES %
\section{Objectives}

The main objective of this study is to ascertain how or to what degree the assessment of privacy risk factors for \mH apps can be automated.
This will be done by implementing a software tool that downloads, decompiles and analyses the source code of \mH apps.


% DEFINITIONS %
\section{Definitions}
Certain terms are used in the remainder of this thesis that have to be defined:

% Mobile health apps
\subsection{Mobile health apps}

Mobile health \acs{mHealth} apps are smartphone or tablet applications that support the users by enabling them to gather information and support about medical or health related issues.\footnote{See \cite{Dehling2015b}, p. 1}

% Static code analysis %
\subsection{Static code analysis}

Static code analysis refers to the analysis of an applications source code without actually executing the application. 
This technique is widely used to detect vulnerabilities or to validate the source code at programming time in e.g. the code editor software. \footnote{See \cite{bardas2010static}, p. 2-3}

% Decompilation %
\subsection{Decompilation}

Compilers transfer human readable programming code into machine code and therefore help humans write software applications in understandable text form. 
Decompilers retrieve the human readable programming code back from the compiled machine code. 
They aim at reversing the compilation process.
\footnote{This section follows \cite{nolan2012decompiling}, p. 1-2}

% METHODS %
\section{Methods}

% Automating the privacy risk assessment %
\subsection{Automating the privacy risk assessment}

% android decompilation
\subsubsection{Android decompilation}

In order to automate the privacy risk assessment of \mH apps via \sca, it is necessary to gain access the source code of the apps. 
While uploading a new app to the Apple AppStore, Apple's digital rights management (\acs{DRM}) system encrypts the binary file in a way that makes recovering the source code difficult. 
There are approaches on decompiling the Apple app binary back into its source code.
These approaches involve unlocking and jailbreaking
\footnote{Jailbreaking revers to the action of removing ... \cite{Kweller2010}, p. 1}
an Apple iPhone or iPad, which is a violation of the Apple terms of service and therefore forbidden\footnote{\cite{Kweller2010}, p. 1}

The Google PlayStore on the other hand hosts Android application in \acs{APK} containers that are non encrypted and allow for decompilation back into the original source files. 
In order to automate the download process of \acs{APK} files to our local computer, we found a hidden Google \acs{API} that reveals access to the \acs{APK} files from the PlayStore. 
The \acs{API} can be queried by sending an Android device id along, effectively pretending to be a requesting Android device.
The result of the query is a binary \acs{APK} file.

\cite{Xu2015} provision a repository of apps listings that are extracted from the Google PlayStore within the categories "Health \& Fitness" and "Medical".
Due to the obstacles of gaining access to the Apple iOS binary files, we restrict the dataset to the available Android apps and conduct our automated privacy risk assessment on these apps.
The \cite{Xu2015} dataset contains 5379 Android apps. 
We exclude paid apps from further proceeding, since downloading paid apps would charge the credit card of the authors, since we use the same \acs{API} that the Google PlayStore itself uses to purchase apps from the store on Android devices. 
Downloading all 5379 apps would result in purchasing costs of 19,904.24 US-dollars. 
Therefore we reduce the dataset to the 3180 free apps, which is still 59.1\% of the  initial dataset. 
We will download as many apps of these 3180 as possible.
Potential limitations in downloading could arise from the fact that Google blocks requests on the API as soon as the system detects overly use or misuse. Downloading 3180 apps at a time will likely trigger these security mechanisms of Google, since a normal user could never download that many apps in the same timeframe from the PlayStore.

As soon as the \acs{APK} files are available offline, the decompiling phase of the study will begin.
Our decompiling process consists of four steps.

The first step is to recover a java archive (\acs{JAR}) file from the \acs{APK} file.
\acs{JAR} files contain a collection of .class files. 
These .class files hold Java bytecode that can be interpreted by the Java virtual machine \acs{JVM} at application runtime.\footnote{The previous two sentences follow \cite{Enck2011}, p. 2} 
In order to extract the Java bytecode .class files, we use the command line tool \textit{dex2jar}\footnote{https://github.com/pxb1988/dex2jar, visited 02/03/2016}. 
The abbreviation \acs{DEX} stands for \acl{DEX} and refers to the binary collection of compiled Java classes within the \acs{APK} file.\footnote{See \cite{xu2013techniques}, p. 6}

Step two includes the actual decompiling phase of the Java bytecode back into readable .java files. 
A .java file contains exactly one Java \textit{class} in humanly readable Java code. 
\cite{Enck2011} developed their own Java decompiling toolchain in order to assess security issues and used within their toolchain used a tool called \textit{Soot}.
\textit{Soot} optimizes the decompiled code to improve the readability by humans.
Aside from using \textit{Soot}, \cite{Enck2011} propose the idea to use different Android decompiler tools, such as \textit{JD} or \textit{Fernflower} in future research, since \textit{Soot} did not perform well in all cases.  \footnote{For the previous three sentences, see \cite{Enck2011}, p. 5}
We will use \textit{Fernflower} as the decompiling tool for our study, since it evidentially outperformed \textit{Soot} in a further evaluation by \cite{Enck2011}.\footnote{\cite{Enck2011}, p. 6}
The result of this second step is a directory full of .java files that represent the source code of an \acs{APK} app.

The decompiling process delivers source code files that lack any formatting.
For the case of manually validating the output of the automated privacy risk assessment we will have to take a look into the source code files. 
To make manual code inspections easier to read, a tool called \textit{astyle}\footnote{http://astyle.sourceforge.net/, visited 02/03/2016} will be used. 
\textit{astyle} sets appropriate levels on indenting to the source code.

In the fourth and last step of our decompilation process, a tool called \textit{apktool}\footnote{https://github.com/iBotPeaches/Apktool, visited 03/02/2016} is used to extract all resource files from the \acs{APK} file. Resource files could be images or XML files that are not compiled into application code.\footnote{See \cite{xu2013techniques}, p. 5}

% static code analysis %
\subsubsection{Static code analysis}
In order to analyse potential privacy risks, we are going to use a static code analysis tool.
This tool will scan and parse the Java source code files and make them computer readable.

\cite{Bruggemann2016} identified six potential privacy risk factors that a \mH app could pose and combined them into a privacy risk index formula. 
The six factors contain three binary factors.
The first binary factor is whether an app requires a login via username/email or a social media login service such as Facebook. 
The second binary factor is the question if the app uses secured \acs{HTTP} connections to the servers it is communicating too.
While the first ones can be assessed at a reasonable level of difficulty via static code analysis, it is challenging to do so for third binary factor: reasonableness of personal data collection. 
The reasonableness of personal data collection assessment in the study of \cite{Bruggemann2016} was based on usage observation of the app. This might not be feasible in a static code analysis.
The non-binary factors include the categories of personal data that users have to input into the \mH apps. Examples of personal data categories are: Medication intake, Symptoms, Vital values.
The last two factors express the target to which the personal data is likely to be sent. 
This is split in two factors, one for unspecific data targets, which refers to the usage of advertisement banner services or analytics tools within the app. 
The other data target factor tries to observe immediate data connections after input of personal data. 
\cite{Bruggemann2016} observed that personal data might be sent to a server of the app provider, advertisement or marketing companies, social media networks (such as Facebook) or to research projects.\footnote{This section follows \cite{Bruggemann2016}, p. 1-99}

Our study aims at identifying the privacy risk factors from \cite{Bruggemann2016} by scanning the source code of each app in our working dataset. 
In order to identify whether an app required the users to login, the source code will be scanned for text input fields that are labelled with the substrings "login", "register", "password". 
Additionally, the source code will be scanned for social network login buttons.
They are identified by the button name "com.facebook.login.widget.LoginButton" for Facebook login, "SignInButton" for Google login and "com.twitter.sdk.android.core.identity.TwitterLoginButton" for Twitter login functionality.


\subsection{Evaluation}

% STRUCTURE %
\section{Structure}

% EXPECTED RESULTS %
\section{Expected Results}

% PROBLEMS %
\section{Problems}
So far there are no open questions or problems. Though, a problem could arise from the fact that the core of this thesis relies on a undocumented Google \acs{API} for downloading the \acs{APK} files of the apps. 
If this \acs{API} is shut down or somehow secured from open usage, it would not be as easy to gather the needed \acs{APK} files for the \sca as it currently is.

% --------------------
% REFERENCES
% --------------------
\newpage
\printbibliography[title={References}]
\addcontentsline{toc}{section}{References}
\end{document}